/* Visual V3: micro-interactions + mobile QA */

:root {
  --v3-fast: 180ms;
  --v3-normal: 340ms;
  --v3-slow: 680ms;
  --v3-ease: cubic-bezier(0.22, 1, 0.36, 1);
  --v3-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
}

html,
body {
  max-width: 100%;
}

.v2-page {
  -webkit-tap-highlight-color: transparent;
  overflow-x: clip;
}

/* Performance mode */
html.perf-lite {
  --glass-blur: 8px;
}

html.perf-lite body::before {
  opacity: 0.12 !important;
}

html.perf-lite .galaxy-bg,
html.perf-lite .galaxy-background {
  filter: saturate(0.82) contrast(0.9);
}

html.perf-lite .nebula,
html.perf-lite .stars-container,
html.perf-lite .stars-lg,
html.perf-lite .stars-sm,
html.perf-lite .planet-container {
  animation: none !important;
}

html.perf-lite .card,
html.perf-lite .report-card,
html.perf-lite .chat-card,
html.perf-lite .bottom-sheet,
html.perf-lite .navbar,
html.perf-lite .bottom-nav,
html.perf-lite .task-header,
html.perf-lite .monthly-header,
html.perf-lite .page-header {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

html.perf-lite .card,
html.perf-lite .report-card,
html.perf-lite .goal-card,
html.perf-lite .todo-card,
html.perf-lite .day-card,
html.perf-lite .task-item,
html.perf-lite .memory-card,
html.perf-lite .chat-card {
  box-shadow: 0 10px 20px -14px rgba(0, 0, 0, 0.72) !important;
}

html.perf-lite .glow-ring .progress,
html.perf-lite .progress-fill,
html.perf-lite .progress-bar-fill,
html.perf-lite .cc-progress-fill,
html.perf-lite .cc-bar-fill {
  transition-duration: 220ms !important;
}

html.perf-lite .cc-reveal,
html.perf-lite [data-v2-reveal],
html.perf-lite .cc-feed-item,
html.perf-lite .task-item,
html.perf-lite .goal-card,
html.perf-lite .report-card,
html.perf-lite .v3-complete-burst,
html.perf-lite .v3-mood-pop,
html.perf-lite .v3-feed-in,
html.perf-lite .v3-assistant-arrived {
  animation: none !important;
  transition-duration: 120ms !important;
  transform: none !important;
}

html.perf-lite .assistant-bubble.v3-assistant-typing::after {
  animation: none !important;
}

html.perf-lite #solar-system-layer {
  display: none !important;
}

/* Completion interactions */
.v3-complete-burst {
  position: relative;
  isolation: isolate;
}

.v3-complete-burst::after {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: inherit;
  border: 1px solid hsla(140, 68%, 56%, 0.72);
  box-shadow: 0 0 0 0 hsla(140, 68%, 56%, 0.45);
  pointer-events: none;
  animation: v3CompleteRing var(--v3-slow) var(--v3-ease) forwards;
}

.task-item.v3-complete-burst,
.list-item.v3-complete-burst,
.day-box.v3-complete-burst {
  animation: v3CompleteLift var(--v3-normal) var(--v3-spring);
}

/* Mood interactions */
#mood-grid .prio-btn.v3-mood-pop,
#mood-grid .mood-btn.v3-mood-pop,
#mood-grid .mood-btn-enhanced.v3-mood-pop {
  animation: v3MoodPop 320ms var(--v3-spring);
}

.bottom-sheet.v3-mood-saved {
  position: relative;
  overflow: hidden;
}

.bottom-sheet.v3-mood-saved::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: linear-gradient(110deg, transparent, hsla(var(--nebula-core), 0.14), transparent);
  animation: v3MoodSweep 620ms var(--v3-ease);
}

/* Goal progress interactions */
.goal-card.v3-progress-glow {
  border-color: hsla(var(--nebula-core), 0.52) !important;
  box-shadow:
    0 22px 36px -22px rgba(0, 0, 0, 0.75),
    0 0 0 1px hsla(var(--nebula-core), 0.22);
}

.goal-card.v3-progress-glow .progress-fill {
  box-shadow: 0 0 16px hsla(var(--nebula-core), 0.45);
}

/* Assistant feedback interactions */
.assistant-bubble.v3-assistant-typing {
  position: relative;
  overflow: hidden;
}

.assistant-bubble.v3-assistant-typing::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(105deg, transparent 20%, hsla(var(--nebula-core), 0.2) 50%, transparent 80%);
  transform: translateX(-110%);
  animation: v3AssistantTyping 1100ms linear infinite;
  pointer-events: none;
}

.assistant-bubble.v3-assistant-arrived {
  animation: v3AssistantArrive 420ms var(--v3-spring);
}

#assistant-feed-card.v3-assistant-refresh {
  box-shadow:
    0 24px 40px -28px rgba(0, 0, 0, 0.8),
    0 0 0 1px hsla(var(--nebula-core), 0.2),
    0 0 22px hsla(var(--nebula-core), 0.32);
}

.cc-feed-item.v3-feed-in {
  animation: v3FeedSlide 360ms var(--v3-ease) both;
  animation-delay: var(--v3-feed-delay, 0ms);
}

#assistant-box.v3-assistant-pulse {
  animation: v3AssistantPulse 560ms var(--v3-ease);
}

.v3-assistant-nudge {
  position: fixed;
  left: 14px;
  right: 14px;
  bottom: 84px;
  z-index: 3200;
  background: linear-gradient(140deg, hsla(var(--nebula-core), 0.2), hsla(var(--space-900), 0.92));
  border: 1px solid hsla(var(--nebula-core), 0.36);
  border-radius: 14px;
  padding: 10px 12px;
  color: hsl(var(--text-100));
  font-size: 0.82rem;
  line-height: 1.35;
  box-shadow: 0 24px 44px -24px rgba(0, 0, 0, 0.84);
  opacity: 0;
  transform: translateY(12px);
  pointer-events: none;
  transition: opacity var(--v3-fast) ease, transform var(--v3-fast) ease;
}

.v3-assistant-nudge.show {
  opacity: 1;
  transform: translateY(0);
}

.v3-assistant-nudge strong {
  color: hsl(var(--nebula-core));
  font-weight: 700;
}

/* Mobile QA: 320-430 */
@media (max-width: 430px) {
  .v2-page .navbar {
    padding: 11px 12px;
  }

  .v2-page .brand {
    font-size: 0.98rem;
    gap: 8px;
  }

  .v2-page .container {
    margin-top: 12px;
    padding-left: 12px;
    padding-right: 12px;
  }

  .v2-page .card {
    padding: 16px;
    border-radius: 18px;
  }

  .v2-page .btn {
    padding: 10px 12px;
    font-size: 0.78rem;
    gap: 6px;
  }

  .v2-page .bottom-nav {
    height: 70px;
    padding: 0 4px;
  }

  .v2-page .nav-item {
    gap: 3px;
    font-size: 9px;
  }

  .v2-page .nav-item i {
    font-size: 1.08rem;
  }

  .v2-page .bottom-sheet {
    border-top-left-radius: 18px !important;
    border-top-right-radius: 18px !important;
    padding: 18px 14px calc(18px + env(safe-area-inset-bottom, 0px)) !important;
  }

  .v2-page .fab,
  .v2-page .add-btn-floating {
    width: 52px;
    height: 52px;
    right: 14px;
    bottom: 82px;
    font-size: 20px;
  }

  .tasks-page .task-header {
    padding: 18px 12px 14px;
  }

  .tasks-page .filter-bar {
    padding: 10px 12px;
    gap: 8px;
  }

  .tasks-page .task-list-container {
    padding: 12px 12px 96px;
  }

  .tasks-page .task-item {
    padding: 12px 14px;
  }

  .chat-page .container.chat-container {
    height: calc(100vh - 138px);
    margin-top: 6px;
  }

  .chat-page .chat-messages {
    padding: 12px;
  }

  .chat-page .chat-input {
    padding: 10px 12px;
    gap: 8px;
  }

  .chat-page .chat-input .btn {
    width: 40px;
    height: 40px;
  }

  .goals-page .page-header {
    padding: 16px 12px 12px;
  }

  .goals-page .content-scroll {
    padding: 12px;
    padding-bottom: 96px;
  }

  .goals-page .goal-card {
    padding: 14px;
  }

  .monthly-page .monthly-header {
    padding: 12px;
  }

  .monthly-page .content-area {
    padding: 12px 12px 96px;
  }

  .monthly-page .todo-card {
    padding: 12px;
  }

  .monthly-page .day-box {
    flex: 0 0 22px;
    height: 22px;
    font-size: 10px;
  }

  .schedule-page .schedule-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
  }

  .schedule-page .day-card {
    padding: 8px;
    min-height: 0;
  }

  .schedule-page .class-item {
    padding: 5px;
    margin-bottom: 5px;
  }

  .schedule-page .class-subject {
    font-size: 0.72rem;
  }

  .schedule-page .class-time,
  .schedule-page .class-room,
  .schedule-page .class-lecturer {
    font-size: 0.58rem;
  }

  .schedule-page .assistant-advice-box {
    padding: 14px;
    gap: 12px;
  }

  .schedule-page .assistant-icon {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    font-size: 1.1rem;
  }

  .report-page .container {
    margin-top: 10px;
    padding-left: 12px;
    padding-right: 12px;
    padding-bottom: 96px;
  }

  .report-page .report-header h1 {
    font-size: 1.24rem;
    letter-spacing: 0.06em;
  }

  .report-page .stat-grid {
    grid-template-columns: 1fr;
  }

  .report-page .insights-card {
    padding: 14px;
  }

  .memories-page .container {
    margin-top: 10px;
  }

  .memories-page .memories-grid {
    gap: 12px;
  }

  .memories-page .memory-img {
    height: 170px;
  }

  .anniversary-page .countdown {
    gap: 6px;
  }

  .anniversary-page .time-box {
    min-width: 0;
    flex: 1;
  }

  .command-center-page .container.cc-shell {
    margin-top: 10px;
    gap: 12px;
    padding-left: 12px;
    padding-right: 12px;
    padding-bottom: 98px;
  }

  .command-center-page .cc-card {
    border-radius: 18px;
  }

  .command-center-page .cc-module-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 8px;
  }

  .command-center-page .cc-module {
    min-height: 74px;
    padding: 10px 6px;
  }

  .command-center-page .cc-module span {
    font-size: 0.62rem;
  }

  .login-page.v2-page {
    padding-bottom: 0 !important;
    overflow: hidden;
  }
}

@media (max-width: 360px) {
  .v2-page .container {
    padding-left: 10px;
    padding-right: 10px;
  }

  .v2-page .card {
    padding: 14px;
  }

  .v2-page .section-title {
    font-size: 0.86rem;
    letter-spacing: 0.05em;
  }

  .v2-page .btn {
    font-size: 0.74rem;
    padding: 9px 10px;
  }

  .schedule-page .schedule-grid {
    grid-template-columns: 1fr;
  }

  .command-center-page .cc-countdown .time-box label {
    letter-spacing: 0.05em;
  }

  .command-center-page .cc-item {
    gap: 10px;
    padding: 10px 11px;
  }
}

.settings-page .activity-analytics-card {
  grid-column: 1 / -1;
}

.settings-page .activity-analytics-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 14px;
}

.settings-page .activity-kpi-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 10px;
  margin-bottom: 14px;
}

.settings-page .activity-kpi {
  border: 1px solid hsla(var(--nebula-core), 0.24);
  background: hsla(230, 34%, 8%, 0.56);
  border-radius: 14px;
  padding: 10px 12px;
}

.settings-page .activity-kpi span {
  display: block;
  font-size: 0.68rem;
  letter-spacing: 0.05em;
  color: hsl(var(--text-400));
  margin-bottom: 6px;
  text-transform: uppercase;
}

.settings-page .activity-kpi strong {
  display: block;
  font-size: 1.08rem;
  color: hsl(var(--text-100));
}

.settings-page .activity-analytics-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
}

.settings-page .activity-panel {
  border: 1px solid hsla(var(--nebula-core), 0.18);
  border-radius: 14px;
  padding: 12px;
  background: hsla(230, 34%, 7%, 0.42);
}

.settings-page .activity-panel h3 {
  margin: 0 0 10px;
  font-size: 0.78rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: hsl(var(--text-300));
}

.settings-page .activity-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.settings-page .activity-row {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.settings-page .activity-row-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.settings-page .activity-row-title {
  font-size: 0.76rem;
  color: hsl(var(--text-200));
  word-break: break-word;
}

.settings-page .activity-row-value {
  font-size: 0.72rem;
  color: hsl(var(--text-400));
  white-space: nowrap;
}

.settings-page .activity-row-track {
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: hsla(var(--nebula-core), 0.12);
  overflow: hidden;
}

.settings-page .activity-row-fill {
  height: 100%;
  border-radius: inherit;
  background: linear-gradient(90deg, hsl(var(--nebula-core)), hsl(var(--nebula-pulse)));
}

.settings-page .activity-empty {
  font-size: 0.74rem;
  color: hsl(var(--text-500));
  padding: 8px 0;
}

.settings-page .activity-heatmap {
  display: grid;
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap: 6px;
}

.settings-page .activity-heatmap-cell {
  border: 1px solid hsla(var(--nebula-core), 0.16);
  border-radius: 10px;
  min-height: 44px;
  padding: 6px 4px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  background: hsla(230, 35%, 6%, 0.5);
}

.settings-page .activity-heatmap-cell .hour {
  font-size: 0.62rem;
  color: hsl(var(--text-500));
}

.settings-page .activity-heatmap-cell strong {
  font-size: 0.74rem;
  color: hsl(var(--text-200));
}

.settings-page .activity-heatmap-cell.intensity-0 {
  opacity: 0.55;
}

.settings-page .activity-heatmap-cell.intensity-1 {
  border-color: hsla(var(--nebula-core), 0.24);
}

.settings-page .activity-heatmap-cell.intensity-2 {
  border-color: hsla(var(--nebula-core), 0.36);
  background: hsla(var(--nebula-core), 0.12);
}

.settings-page .activity-heatmap-cell.intensity-3 {
  border-color: hsla(var(--nebula-core), 0.48);
  background: hsla(var(--nebula-core), 0.2);
}

.settings-page .activity-heatmap-cell.intensity-4 {
  border-color: hsla(var(--nebula-core), 0.64);
  background: linear-gradient(145deg, hsla(var(--nebula-core), 0.3), hsla(var(--nebula-pulse), 0.24));
}

@media (max-width: 860px) {
  .settings-page .activity-kpi-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .settings-page .activity-analytics-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 430px) {
  .settings-page .activity-analytics-head {
    flex-direction: column;
    align-items: stretch;
  }

  .settings-page .activity-analytics-head .btn {
    width: 100%;
  }
}

@keyframes v3CompleteRing {
  from {
    opacity: 0.9;
    transform: scale(0.98);
    box-shadow: 0 0 0 0 hsla(140, 68%, 56%, 0.45);
  }

  to {
    opacity: 0;
    transform: scale(1.07);
    box-shadow: 0 0 0 12px hsla(140, 68%, 56%, 0);
  }
}

@keyframes v3CompleteLift {
  0% {
    transform: translateY(0) scale(1);
  }

  45% {
    transform: translateY(-2px) scale(1.015);
  }

  100% {
    transform: translateY(0) scale(1);
  }
}

@keyframes v3MoodPop {
  0% {
    transform: scale(1);
  }

  45% {
    transform: scale(1.12);
  }

  100% {
    transform: scale(1);
  }
}

@keyframes v3MoodSweep {
  from {
    transform: translateX(-105%);
    opacity: 0.85;
  }

  to {
    transform: translateX(105%);
    opacity: 0;
  }
}

@keyframes v3AssistantTyping {
  from {
    transform: translateX(-110%);
  }

  to {
    transform: translateX(110%);
  }
}

@keyframes v3AssistantArrive {
  0% {
    transform: translateY(8px) scale(0.985);
    opacity: 0.75;
  }

  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

@keyframes v3FeedSlide {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes v3AssistantPulse {
  0% {
    transform: scale(1);
    box-shadow: 0 0 0 0 hsla(var(--nebula-core), 0.35);
  }

  100% {
    transform: scale(1);
    box-shadow: 0 0 0 14px hsla(var(--nebula-core), 0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .v3-complete-burst,
  .v3-mood-pop,
  .v3-progress-glow,
  .v3-assistant-arrived,
  .v3-feed-in,
  #assistant-box.v3-assistant-pulse {
    animation: none !important;
    transition: none !important;
  }
}
